(()=>{"use strict";function t(){this.config={bombRate:.05,bombMinVelocity:50,bombMaxVelocity:50,invaderInitialVelocity:25,invaderAcceleration:0,invaderDropDistance:20,rocketVelocity:120,rocketMaxFireRate:2,gameWidth:400,gameHeight:300,fps:50,debugMode:!1,invaderRanks:5,invaderFiles:10,shipSpeed:120,levelDifficultyMultiplier:.2,pointsPerInvader:5,limitLevelIncrease:25},this.lives=3,this.width=0,this.height=0,this.gameBounds={left:0,top:0,right:0,bottom:0},this.intervalId=0,this.score=0,this.level=1,this.stateStack=[],this.pressedKeys={},this.gameCanvas=null}function i(){}function e(){}function s(t,i){this.config=t,this.level=i,this.invaderCurrentVelocity=10,this.invaderCurrentDropDistance=0,this.invadersAreDropping=!1,this.lastRocketTime=null,this.ship=null,this.invaders=[],this.rockets=[],this.bombs=[]}function h(){}function n(t){this.level=t,this.countdownMessage="3"}function o(t,i){this.x=t,this.y=i,this.width=20,this.height=16}function r(t,i,e){this.x=t,this.y=i,this.velocity=e}function a(t,i,e){this.x=t,this.y=i,this.velocity=e}function l(t,i,e,s,h){this.x=t,this.y=i,this.rank=e,this.file=s,this.type=h,this.width=18,this.height=14}function c(){this.fps=60,this.canvas=null,this.width=0,this.height=0,this.minVelocity=10,this.maxVelocity=20,this.stars=100,this.intervalID=0}function d(t,i,e,s){this.x=t,this.y=i,this.size=e,this.velocity=s}t.prototype.initialise=function(t){this.gameCanvas=t,this.width=t.width,this.height=t.height,this.gameBounds={left:t.width/2-this.config.gameWidth/2,right:t.width/2+this.config.gameWidth/2,top:t.height/2-this.config.gameHeight/2,bottom:t.height/2+this.config.gameHeight/2}},t.prototype.moveToState=function(t){this.currentState()&&this.currentState().leave&&(this.currentState().leave(g),this.stateStack.pop()),t.enter&&t.enter(g),this.stateStack.pop(),this.stateStack.push(t)},t.prototype.start=function(){this.moveToState(new i),this.lives=3,this.config.debugMode=/debug=true/.test(window.location.href);var t=this;this.intervalId=setInterval((function(){!function(t){var i=t.currentState();if(i){var e=1/t.config.fps,s=t.gameCanvas.getContext("2d");i.update&&i.update(t,e),i.draw&&i.draw(t,e,s)}}(t)}),1e3/this.config.fps)},t.prototype.currentState=function(){return this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null},t.prototype.pushState=function(t){t.enter&&t.enter(g),this.stateStack.push(t)},t.prototype.popState=function(){this.currentState()&&(this.currentState().leave&&this.currentState().leave(g),this.stateStack.pop())},t.prototype.stop=function(){clearInterval(this.intervalId)},t.prototype.keyDown=function(t){this.pressedKeys[t]=!0,this.currentState()&&this.currentState().keyDown&&this.currentState().keyDown(this,t)},t.prototype.keyUp=function(t){delete this.pressedKeys[t],this.currentState()&&this.currentState().keyUp&&this.currentState().keyUp(this,t)},i.prototype.update=function(t,i){},i.prototype.draw=function(t,i,e){e.clearRect(0,0,t.width,t.height),e.font="30px Arial",e.fillStyle="#ffffff",e.textBaseline="middle",e.textAlign="center",e.fillText("Space Invaders",t.width/2,t.height/2-40),e.font="16px Arial",e.fillText("Press 'Space' to start.",t.width/2,t.height/2)},i.prototype.keyDown=function(t,i){32==i&&(t.level=1,t.score=0,t.lives=3,t.moveToState(new n(t.level)))},e.prototype.update=function(t,i){},e.prototype.draw=function(t,i,e){e.clearRect(0,0,t.width,t.height),e.font="30px Arial",e.fillStyle="#ffffff",e.textBaseline="center",e.textAlign="center",e.fillText("Game Over!",t.width/2,t.height/2-40),e.font="16px Arial",e.fillText("You scored "+t.score+" and got to level "+t.level,t.width/2,t.height/2),e.font="16px Arial",e.fillText("Press 'Space' to play again.",t.width/2,t.height/2+40)},e.prototype.keyDown=function(t,i){32==i&&(t.lives=3,t.score=0,t.level=1,t.moveToState(new n(1)))},s.prototype.enter=function(t){this.ship=new o(t.width/2,t.gameBounds.bottom),this.invaderCurrentVelocity=10,this.invaderCurrentDropDistance=0,this.invadersAreDropping=!1;var i=this.level*this.config.levelDifficultyMultiplier,e=this.level<this.config.limitLevelIncrease?this.level:this.config.limitLevelIncrease;this.shipSpeed=this.config.shipSpeed,this.invaderInitialVelocity=this.config.invaderInitialVelocity+i*this.config.invaderInitialVelocity*1.5,this.bombRate=this.config.bombRate+i*this.config.bombRate,this.bombMinVelocity=this.config.bombMinVelocity+i*this.config.bombMinVelocity,this.bombMaxVelocity=this.config.bombMaxVelocity+i*this.config.bombMaxVelocity,this.rocketMaxFireRate=this.config.rocketMaxFireRate+.4*e;for(var s=this.config.invaderRanks+.1*e,h=this.config.invaderFiles+.2*e,n=[],r=0;r<s;r++)for(var a=0;a<h;a++)n.push(new l(t.width/2+200*(h/2-a)/h,t.gameBounds.top+20*r,r,a,"Invader"));this.invaders=n,this.invaderCurrentVelocity=this.invaderInitialVelocity,this.invaderVelocity={x:-this.invaderInitialVelocity,y:0},this.invaderNextVelocity=null},s.prototype.update=function(t,i){t.pressedKeys[37]&&(this.ship.x-=this.shipSpeed*i),t.pressedKeys[39]&&(this.ship.x+=this.shipSpeed*i),t.pressedKeys[32]&&this.fireRocket(),this.ship.x<t.gameBounds.left&&(this.ship.x=t.gameBounds.left),this.ship.x>t.gameBounds.right&&(this.ship.x=t.gameBounds.right);for(var s=0;s<this.bombs.length;s++){var h=this.bombs[s];h.y+=i*h.velocity,h.y>this.height&&this.bombs.splice(s--,1)}for(var o=0;o<this.rockets.length;o++){var r=this.rockets[o];r.y-=i*r.velocity,r.y<0&&this.rockets.splice(o--,1)}for(var l=!1,c=!1,d=!1,f=0;f<this.invaders.length;f++){var p=this.invaders[f],v=p.x+this.invaderVelocity.x*i,g=p.y+this.invaderVelocity.y*i;0==l&&v<t.gameBounds.left?l=!0:0==c&&v>t.gameBounds.right?c=!0:0==d&&g>t.gameBounds.bottom&&(d=!0),l||c||d||(p.x=v,p.y=g)}this.invadersAreDropping&&(this.invaderCurrentDropDistance+=this.invaderVelocity.y*i,this.invaderCurrentDropDistance>=this.config.invaderDropDistance&&(this.invadersAreDropping=!1,this.invaderVelocity=this.invaderNextVelocity,this.invaderCurrentDropDistance=0)),l&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,this.invaderVelocity={x:0,y:this.invaderCurrentVelocity},this.invadersAreDropping=!0,this.invaderNextVelocity={x:this.invaderCurrentVelocity,y:0}),c&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,this.invaderVelocity={x:0,y:this.invaderCurrentVelocity},this.invadersAreDropping=!0,this.invaderNextVelocity={x:-this.invaderCurrentVelocity,y:0}),d&&(t.lives=0);for(var y=0;y<this.invaders.length;y++){for(var u=this.invaders[y],w=!1,m=0;m<this.rockets.length;m++){var x=this.rockets[m];if(x.x>=u.x-u.width/2&&x.x<=u.x+u.width/2&&x.y>=u.y-u.height/2&&x.y<=u.y+u.height/2){this.rockets.splice(m--,1),w=!0,t.score+=this.config.pointsPerInvader;break}}w&&this.invaders.splice(y--,1)}for(var b={},k=0;k<this.invaders.length;k++){var S=this.invaders[k];(!b[S.file]||b[S.file].rank<S.rank)&&(b[S.file]=S)}for(var V=0;V<this.config.invaderFiles;V++){var D=b[V];if(D)this.bombRate*i>Math.random()&&this.bombs.push(new a(D.x,D.y+D.height/2,this.bombMinVelocity+Math.random()*(this.bombMaxVelocity-this.bombMinVelocity)))}for(var M=0;M<this.bombs.length;M++){var R=this.bombs[M];R.x>=this.ship.x-this.ship.width/2&&R.x<=this.ship.x+this.ship.width/2&&R.y>=this.ship.y-this.ship.height/2&&R.y<=this.ship.y+this.ship.height/2&&(this.bombs.splice(M--,1),t.lives--)}for(var B=0;B<this.invaders.length;B++){var I=this.invaders[B];I.x+I.width/2>this.ship.x-this.ship.width/2&&I.x-I.width/2<this.ship.x+this.ship.width/2&&I.y+I.height/2>this.ship.y-this.ship.height/2&&I.y-I.height/2<this.ship.y+this.ship.height/2&&(t.lives=0)}t.lives<=0&&t.moveToState(new e),0===this.invaders.length&&(t.score+=50*this.level,t.level+=1,t.moveToState(new n(t.level)))},s.prototype.draw=function(t,i,e){e.clearRect(0,0,t.width,t.height),e.fillStyle="#999999",e.fillRect(this.ship.x-this.ship.width/2,this.ship.y-this.ship.height/2,this.ship.width,this.ship.height),e.fillStyle="#006600";for(var s=0;s<this.invaders.length;s++){var h=this.invaders[s];e.fillRect(h.x-h.width/2,h.y-h.height/2,h.width,h.height)}e.fillStyle="#ff5555";for(var n=0;n<this.bombs.length;n++){var o=this.bombs[n];e.fillRect(o.x-2,o.y-2,4,4)}e.fillStyle="#ff0000";for(var r=0;r<this.rockets.length;r++){var a=this.rockets[r];e.fillRect(a.x,a.y-2,1,4)}var l=t.gameBounds.bottom+(t.height-t.gameBounds.bottom)/2+7;e.font="14px Arial",e.fillStyle="#ffffff";var c="Lives: "+t.lives;e.textAlign="left",e.fillText(c,t.gameBounds.left,l),c="Score: "+t.score+", Level: "+t.level,e.textAlign="right",e.fillText(c,t.gameBounds.right,l),this.config.debugMode&&(e.strokeStyle="#ff0000",e.strokeRect(0,0,t.width,t.height),e.strokeRect(t.gameBounds.left,t.gameBounds.top,t.gameBounds.right-t.gameBounds.left,t.gameBounds.bottom-t.gameBounds.top))},s.prototype.keyDown=function(t,i){32==i&&this.fireRocket(),80==i&&t.pushState(new h)},s.prototype.keyUp=function(t,i){},s.prototype.fireRocket=function(){(null===this.lastRocketTime||(new Date).valueOf()-this.lastRocketTime>1e3/this.rocketMaxFireRate)&&(this.rockets.push(new r(this.ship.x,this.ship.y-12,this.config.rocketVelocity)),this.lastRocketTime=(new Date).valueOf())},h.prototype.keyDown=function(t,i){80==i&&t.popState()},h.prototype.draw=function(t,i,e){e.clearRect(0,0,t.width,t.height),e.font="14px Arial",e.fillStyle="#ffffff",e.textBaseline="middle",e.textAlign="center",e.fillText("Paused",t.width/2,t.height/2)},n.prototype.update=function(t,i){void 0===this.countdown&&(this.countdown=3),this.countdown-=i,this.countdown<2&&(this.countdownMessage="2"),this.countdown<1&&(this.countdownMessage="1"),this.countdown<=0&&t.moveToState(new s(t.config,this.level))},n.prototype.draw=function(t,i,e){e.clearRect(0,0,t.width,t.height),e.font="36px Arial",e.fillStyle="#ffffff",e.textBaseline="middle",e.textAlign="center",e.fillText("Level "+this.level,t.width/2,t.height/2),e.font="24px Arial",e.fillText("Ready in "+this.countdownMessage,t.width/2,t.height/2+36)},c.prototype.create=function(t){var i=this;this.containerDiv=t,i.width=window.innerWidth,i.height=window.innerHeight,window.onresize=function(t){i.width=window.innerWidth,i.height=window.innerHeight,i.canvas.width=i.width,i.canvas.height=i.height,i.draw()};var e=document.createElement("canvas");t.appendChild(e),this.canvas=e,this.canvas.width=this.width,this.canvas.height=this.height},c.prototype.start=function(){for(var t=[],i=0;i<this.stars;i++)t[i]=new d(Math.random()*this.width,Math.random()*this.height,3*Math.random()+1,Math.random()*(this.maxVelocity-this.minVelocity)+this.minVelocity);this.stars=t;var e=this;this.intervalID=setInterval((function(){e.update(),e.draw()}),1e3/this.fps)},c.prototype.stop=function(){clearInterval(this.intervalID)},c.prototype.update=function(){for(var t=1/this.fps,i=0;i<this.stars.length;i++){var e=this.stars[i];e.y+=t*e.velocity,e.y>this.height&&(this.stars[i]=new d(Math.random()*this.width,0,3*Math.random()+1,Math.random()*(this.maxVelocity-this.minVelocity)+this.minVelocity))}},c.prototype.draw=function(){var t=this.canvas.getContext("2d");t.fillStyle="#000000",t.fillRect(0,0,this.width,this.height),t.fillStyle="#ffffff";for(var i=0;i<this.stars.length;i++){var e=this.stars[i];t.fillRect(e.x,e.y,e.size,e.size)}};var f=document.getElementById("outerspace"),p=new c;p.create(f),p.start();var v=document.getElementById("gameCanvas");v.width=800,v.height=600;var g=new t;g.initialise(v),g.start(),window.addEventListener("keydown",(function(t){var i=t.which||window.event.keycode;37!=i&&39!=i&&32!=i||t.preventDefault(),g.keyDown(i)})),window.addEventListener("keyup",(function(t){var i=t.which||window.event.keycode;g.keyUp(i)}))})();